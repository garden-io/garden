kind: Build
name: backend
description: Backend service container image
type: container

---
kind: Deploy
name: backend
description: Backend service container
type: container
dependencies:
  - build.backend
variables:
  ingressPath: /hello-backend
spec:
  image: ${actions.build.backend.outputs.deploymentImageId}
  healthCheck:
    httpGet:
      path: /hello-backend
      port: http
  ports:
    - name: http
      containerPort: 8080
      # Maps service:80 -> container:8080
      servicePort: 80
  ingresses:
    - path: ${var.ingressPath}
      port: http

---
kind: Run
name: backend-run-task
type: container
dependencies:
  - build.backend
spec:
  command: ["sh", "-c", "echo task output"]
  image: ${actions.build.backend.outputs.deploymentImageId}

---
kind: Test
name: backend-test
type: container
dependencies:
  - build.backend
spec:
  command: ["sh", "-c", "echo test output13"]
  image: ${actions.build.backend.outputs.deploymentImageId}
